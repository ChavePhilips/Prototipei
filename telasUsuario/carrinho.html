<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Prototipei</title>
        <link href="../src/css/estilizacaoPadrao.css" rel="stylesheet" type="text/css">
    </head>

    <body>
        <!-- NAVBAR -->
        <header>
            <div class="navbar">
                <a href="home.html"><img class="logoNavbar" src="../src/Imagens/logoReduzidaAzul.png" alt="Logo"></a>
                
                <div class="divLinks">
                    <a href="home.html#secaoProdutosHome"><p class="textoPadrao">Produtos</p></a>
                    <a href="home.html#secaoAgendeConsultoriaHome"><p class="textoPadrao">Consultoria</p></a>
                    <a href="home.html#secaoSobreNosHome"><p class="textoPadrao">Sobre nós</p></a>

                    <a id = "linkPerfil">
                        <div class="divPerfil">

                            <!-- SVG do perfil -->
                            <svg width="67" height="67" viewBox="0 0 67 67" fill="#F1F0EC" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M4 33.5C4 17.2076 17.2076 4 33.5 4C49.7924 4 
                                63 17.2076 63 33.5C63 38.6063 61.7026 43.4095 59.4196 47.5981C55.5332 41.6718 44.9873 37.1729 
                                33.5 37.1729C22.0012 37.1729 11.1313 41.0519 7.12419 46.7267C5.12531 42.7485 4 38.2556 4 33.5ZM33.5 
                                0C14.9985 0 0 14.9985 0 33.5C0 52.0015 14.9985 67 33.5 67C52.0015 67 67 52.0015 67 33.5C67 14.9985 
                                52.0015 0 33.5 0ZM41.496 18.7692C41.496 23.4241 37.8342 27.0383 33.5 27.0383C29.1658 27.0383 25.504 
                                23.4241 25.504 18.7692C25.504 14.1142 29.1658 10.5 33.5 10.5C37.8342 10.5 41.496 14.1142 41.496 
                                18.7692ZM13.2456 54.3959L9.73004 50.2901C10.3091 48.7041 12.0583 46.7278 15.8337 44.8633C20.3811 
                                42.6175 26.7563 41.1729 33.5 41.1729C40.1429 41.1729 46.3373 42.8253 50.7452 45.2736C54.3085 47.2528 
                                56.0904 49.3564 56.7234 51.0725L53.4059 54.2834L48.9229 57.6113L43.632 60.1536L38.4589 61.4307L33.1399 
                                61.9747L27.1783 61.2356L22.8706 60.1567L17.5775 57.6117L13.2456 54.3959ZM33.5 31.0383C40.1278 31.0383 
                                45.496 25.5479 45.496 18.7692C45.496 11.9904 40.1278 6.5 33.5 6.5C26.8722 6.5 21.504 11.9904 21.504 
                                18.7692C21.504 25.5479 26.8722 31.0383 33.5 31.0383Z" fill="#0352A8"/>
                            </svg> 
                        </div>
                    </a>

                    <a href="carrinho.html">
                        <div class="divCarrinho">

                            <!-- SVG do carrinho -->
                            <svg width="65" height="62" viewBox="0 0 65 62" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M2.70898 2.70833H13.5423L20.8007 38.9729C21.0483 40.2198 21.7267 41.3399 22.7169 
                                42.1371C23.7072 42.9342 24.9463 43.3577 26.2173 43.3333H52.5423C53.8133 43.3577 55.0525 42.9342 
                                56.0427 42.1371C57.033 41.3399 57.7113 40.2198 57.959 38.9729L62.2923 16.25H16.2507M27.084 
                                56.875C27.084 58.3708 25.8714 59.5833 24.3757 59.5833C22.8799 59.5833 21.6673 58.3708 21.6673 
                                56.875C21.6673 55.3792 22.8799 54.1667 24.3757 54.1667C25.8714 54.1667 27.084 55.3792 27.084 
                                56.875ZM56.8757 56.875C56.8757 58.3708 55.6631 59.5833 54.1673 59.5833C52.6715 59.5833 51.459 
                                58.3708 51.459 56.875C51.459 55.3792 52.6715 54.1667 54.1673 54.1667C55.6631 54.1667 56.8757 
                                55.3792 56.8757 56.875Z" 
                                stroke="#095DB7" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="#F1F0EC"/>
                            </svg>
                        </div>
                    </a>
                </div>
            </div>
        </header>

        <!-- BANNER -->
        <section id="primeiraSecao" style="margin-top: 11vh;">
            <div class="divBanner">
                <div id="divTextoBanner">
                    <p class="tituloPadraoBranco">CARRINHO</p>
                    <img src="../src/Imagens/logoBranca.png" class="logoBranca" alt="Logo da Prototipei.">
                </div>
            </div>
        </section>

        <section>
            <div class="padroesSecaoFlexDirectionRow" style="justify-content: space-between; padding-bottom: 0vh;">
                <div style="align-items: center;">
                    <input style="width: 1vw; height: 1vw;" type="checkbox" id="todosOsItens" name="tipoPessoa" value="fisica" onclick="todosOsItens()">
                    <label for="todosOsItens" class="textoPadrao" style="margin-left: 1vw;">TODOS OS ITENS</label>
                </div>
                
                <div>
                    <button class="botaoAzul" id="linkCompra">COMPRAR</button>   
                </div>
            </div>
                
            <!-- QUADRADO COM O PRODUTO -->
            <div class="padroesSecaoFlexDirectionRow divBordaEscura" style="align-items: center; padding: 2%;">
                <div style="align-items: center;">
                    <input id="produto1" style="width: 1vw; height: 1vw;" type="checkbox">
                </div>

                <img src="../src/Imagens/imagemEstufa.png" class="imagensPadrao"/>
                
                <div class="padroesSecaoFlexDirectionColumn" style="width: 100%;">
                    
                    <div class="secaoRotasFlexDirectionRow">
                        <p class="textoPadrao">Estufa portátil inteligente Pé de Feijão...</p>
                        <p class="textoPadrao">10/07</p> <!-- LIGAR COM O BANCO DE DADOS -->
                    </div>

                    <div class="secaoRotasFlexDirectionRow">
                        <div class="secaoRotasFlexDirectionRow" style="align-items: center;">
                            <p class="textoPadrao">R$500,00</p>

                            <p class="textoPadrao">QT: 1</p>
                        </div>

                        <div class="secaoRotasFlexDirectionRow">
                            <div>            
                                <p class="textoPadrao">Quantidade:</p>
                                <button id="decrease" class="botaoMaisMenos">-</button>
                                <input class="inputBotaoMaisMenos" type="number" id="quantity" value="1" min="1" readonly>
                                <button id="increase" class="botaoMaisMenos">+</button>
                            </div>
    
                            <div style="place-content: center;">
                                <span class="material-symbols-outlined iconesComHover" style="font-size: 22pt; text-align: right;">delete</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- QUADRADO COM O PRODUTO -->
            <div class="padroesSecaoFlexDirectionRow divBordaEscura" style="align-items: center; padding: 2%; margin-top: 1%;">
                <div style="align-items: center;">
                    <input style="width: 1vw; height: 1vw;" type="checkbox">
                </div>

                <img src="../src/Imagens/imagemEstufa.png" class="imagensPadrao"/>
                
                <div class="padroesSecaoFlexDirectionColumn" style="width: 100%;">
                    
                    <div class="secaoRotasFlexDirectionRow">
                        <p class="textoPadrao">Estufa portátil inteligente Pé de Feijão...</p>
                        <p class="textoPadrao">10/07</p> <!-- LIGAR COM O BANCO DE DADOS -->
                    </div>

                    <div class="secaoRotasFlexDirectionRow">
                        <div class="secaoRotasFlexDirectionRow" style="align-items: center;">
                            <p class="textoPadrao">R$500,00</p>

                            <p class="textoPadrao">QT: 1</p>
                        </div>

                        <div class="secaoRotasFlexDirectionRow">
                            <div>            
                                <p class="textoPadrao">Quantidade:</p>
                                <button id="decrease" class="botaoMaisMenos">-</button>
                                <input class="inputBotaoMaisMenos" type="number" id="quantity" value="1" min="1" readonly>
                                <button id="increase" class="botaoMaisMenos">+</button>
                            </div>
    
                            <div style="place-content: center;">
                                <span class="material-symbols-outlined iconesComHover" style="font-size: 22pt; text-align: right;">delete</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FOOTER -->
        <div class="margemSuperior" style="background-color: #047EFF; height: 8vh;"></div>

        <footer style="margin-top: 0%;">
            <div class="padroesSecaoFlexDirectionRow" style="padding: 5% 0%;">
                <div style="place-content: center; width: 30%;">
                    <img src="../src/Imagens/logoBranca.png" width="100%"/>
                </div>

                <hr>

                <div style="width: 30%;">
                    <p class="textoPadraoBranco">©2024, Prototipei. <br> Todos os direitos reservados.</p>
                </div>

                <div class="padroesSecaoFlexDirectionColumn" style="gap: 0vw; width: 40%;">
                    <p class="textoPadraoBranco" style="text-align: right; ">prototipeiltda@gmail.com <br> R. Miguel Ortega, 135</p>
                </div>
            </div>
        </footer>

        <script src="../src/js/javascriptPadrao.js"></script>

        <script type="module">
            // Configuração do Firebase
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
            import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

            const firebaseConfig = {
                apiKey: "AIzaSyBVMWxw3ubEE6HWWxzu1H_BhnWzRXQwd2g",
                authDomain: "prototipei.firebaseapp.com",
                projectId: "prototipei",
                storageBucket: "prototipei.firebasestorage.app",
                messagingSenderId: "507053339898",
                appId: "1:507053339898:web:efac2b22db7bde679d4543"
            };

            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            async function atualizarEstoque() {
                try {
                    // Consultando o estoque da estufa
                    const estufaRef = doc(db, "estoque", "Estufa");
                    const estufaDoc = await getDoc(estufaRef);
                    if (estufaDoc.exists()) {
                        const qt_e = estufaDoc.data().QT_E; // Quantidade da estufa
                        localStorage.setItem("qt_e", qt_e); // Armazenando no localStorage
                    } else {
                        console.log("Documento 'Estufa' não encontrado!");
                    }

                    // Consultando o estoque da porta
                    const portaRef = doc(db, "estoque", "Porta");
                    const portaDoc = await getDoc(portaRef);
                    if (portaDoc.exists()) {
                        const qt_p = portaDoc.data().QT_P; // Quantidade da porta
                        localStorage.setItem("qt_p", qt_p); // Armazenando no localStorage
                    } else {
                        console.log("Documento 'Porta' não encontrado!");
                    }
                } catch (error) {
                    console.error("Erro ao atualizar estoque:", error);
                }
            }

            // Chamando a função para atualizar o estoque ao carregar a página
            atualizarEstoque();

            function todosOsItens() {
                // CHECKBOX TODOS OS ITENS
                const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                const idTodosOsItens = document.getElementById('todosOsItens');

                if (idTodosOsItens.checked) {
                    checkboxes.forEach(function(checkbox) {
                        checkbox.checked = true;
                    });
                } else {
                    checkboxes.forEach(function(checkbox) {
                        checkbox.checked = false;
                    });
                }
            }

            // Aguarda o carregamento do DOM
            document.addEventListener("DOMContentLoaded", function() {
                // Obtém as informações do usuário armazenadas no localStorage
                const usuarioLogado = localStorage.getItem("dadosUsuario");

                // Seleciona os elementos do DOM
                const linkPerfil = document.getElementById("linkPerfil");
                const linkCompra = document.getElementById("linkCompra");

                // Garante que os elementos existem antes de adicionar os eventListeners
                if (linkPerfil && linkCompra) {
                    if (usuarioLogado) {
                        // Usuário está logado
                        linkPerfil.addEventListener("click", function(event) {
                            event.preventDefault(); // Evita comportamento padrão
                            window.location.href = "../telasUsuario/perfil.html"; // Redireciona para o perfil
                        });

                        linkCompra.addEventListener("click", function(event) {
                            event.preventDefault(); // Evita comportamento padrão
                            window.location.href = "../telasUsuario/finalizarCompra1.html"; // Redireciona para finalizar compra
                        });
                    } else {
                        // Usuário não está logado
                        linkPerfil.addEventListener("click", function(event) {
                            event.preventDefault(); // Evita comportamento padrão
                            window.location.href = "../cadastro/login.html"; // Redireciona para login
                        });

                        linkCompra.addEventListener("click", function(event) {
                            event.preventDefault(); // Evita comportamento padrão
                            window.location.href = "../cadastro/login.html"; // Redireciona para login
                        });
                    }
                } else {
                    console.error("Erro: Elementos de link 'Perfil' ou 'Comprar' não encontrados no DOM.");
                }
            });
        </script>
    </body>
</html>
