<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Prototipei</title>
        <link href="../src/css/estilizacaoPadrao.css" rel="stylesheet" type="text/css">
        <link href="../src/css/cssFormularios.css" rel="stylesheet" type="text/css">
    </head>
    
    <body>
        <!-- NAVBAR -->
        <header>
            <div class="navbar">
                <a href="home.html"><img class="logoNavbar" src="../src/Imagens/logoReduzidaAzul.png" alt="Logo"></a>
                
                <div class="divLinks">
                    <a href="home.html#secaoProdutosHome"><p class="textoPadrao">Produtos</p></a>
                    <a href="home.html#secaoAgendeConsultoriaHome"><p class="textoPadrao">Consultoria</p></a>
                    <a href="home.html#secaoSobreNosHome"><p class="textoPadrao">Sobre nós</p></a>

                    <a href="perfil.html">
                        <div class="divPerfil">

                            <!-- SVG do perfil -->
                            <svg width="67" height="67" viewBox="0 0 67 67" fill="#F1F0EC" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M4 33.5C4 17.2076 17.2076 4 33.5 4C49.7924 4 
                                63 17.2076 63 33.5C63 38.6063 61.7026 43.4095 59.4196 47.5981C55.5332 41.6718 44.9873 37.1729 
                                33.5 37.1729C22.0012 37.1729 11.1313 41.0519 7.12419 46.7267C5.12531 42.7485 4 38.2556 4 33.5ZM33.5 
                                0C14.9985 0 0 14.9985 0 33.5C0 52.0015 14.9985 67 33.5 67C52.0015 67 67 52.0015 67 33.5C67 14.9985 
                                52.0015 0 33.5 0ZM41.496 18.7692C41.496 23.4241 37.8342 27.0383 33.5 27.0383C29.1658 27.0383 25.504 
                                23.4241 25.504 18.7692C25.504 14.1142 29.1658 10.5 33.5 10.5C37.8342 10.5 41.496 14.1142 41.496 
                                18.7692ZM13.2456 54.3959L9.73004 50.2901C10.3091 48.7041 12.0583 46.7278 15.8337 44.8633C20.3811 
                                42.6175 26.7563 41.1729 33.5 41.1729C40.1429 41.1729 46.3373 42.8253 50.7452 45.2736C54.3085 47.2528 
                                56.0904 49.3564 56.7234 51.0725L53.4059 54.2834L48.9229 57.6113L43.632 60.1536L38.4589 61.4307L33.1399 
                                61.9747L27.1783 61.2356L22.8706 60.1567L17.5775 57.6117L13.2456 54.3959ZM33.5 31.0383C40.1278 31.0383 
                                45.496 25.5479 45.496 18.7692C45.496 11.9904 40.1278 6.5 33.5 6.5C26.8722 6.5 21.504 11.9904 21.504 
                                18.7692C21.504 25.5479 26.8722 31.0383 33.5 31.0383Z" fill="#0352A8"/>
                            </svg> 
                        </div>
                    </a>

                    <a href="carrinho.html">
                        <div class="divCarrinho">

                            <!-- SVG do carrinho -->
                            <svg width="65" height="62" viewBox="0 0 65 62" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M2.70898 2.70833H13.5423L20.8007 38.9729C21.0483 40.2198 21.7267 41.3399 22.7169 
                                42.1371C23.7072 42.9342 24.9463 43.3577 26.2173 43.3333H52.5423C53.8133 43.3577 55.0525 42.9342 
                                56.0427 42.1371C57.033 41.3399 57.7113 40.2198 57.959 38.9729L62.2923 16.25H16.2507M27.084 
                                56.875C27.084 58.3708 25.8714 59.5833 24.3757 59.5833C22.8799 59.5833 21.6673 58.3708 21.6673 
                                56.875C21.6673 55.3792 22.8799 54.1667 24.3757 54.1667C25.8714 54.1667 27.084 55.3792 27.084 
                                56.875ZM56.8757 56.875C56.8757 58.3708 55.6631 59.5833 54.1673 59.5833C52.6715 59.5833 51.459 
                                58.3708 51.459 56.875C51.459 55.3792 52.6715 54.1667 54.1673 54.1667C55.6631 54.1667 56.8757 
                                55.3792 56.8757 56.875Z" 
                                stroke="#095DB7" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="#F1F0EC"/>
                            </svg>
                        </div>
                    </a>
                </div>
            </div>
        </header>

        <!-- BANNER -->
        <section id="primeiraSecao" style="margin-top: 11vh;">
            <div class="divBanner">
                <div id="divTextoBanner">
                    <p class="tituloPadraoBranco">MEU PERFIL</p>
                    <img src="../src/Imagens/logoBranca.png" class="logoBranca" alt="Logo da Prototipei.">
                </div>
            </div>
        </section>

        <!-- BANNER - SETA BRANCA -->
        <section>
            <div class="setaBranca-banner">
                <img id="setaBranca" src="../src/Imagens/setaBranca.png">
            </div>
        </section>

        <!-- INTRODUÇÃO -->
        <section class="padroesSecaoFlexDirectionRow">
            <div>
                <img src="../src/Imagens/iconePerfil.png" alt="Sua foto de perfil."/>
            </div>

            <div style="align-content: center; padding-left: 1.5vw;">
                <p class="tituloPadrao" id="nome">OLÁ, BEM VINDO!</p>
            </div>

            <div style="place-content: center; width: 40%; text-align: right;">
                <a href="configuracoes.html">
                    <span class="material-symbols-outlined iconesComHover" style="font-size: 50pt;">
                        settings
                    </span>
                </a>
            </div>
        </section>
        
        <section class="margemPadrao" style="padding-top: 0%;">
            <button class="botaoBranco" style="width: 100%; border: 2px solid;" onclick="window.location.href = 'minhasComprasRota.html'">MINHAS COMPRAS</button>
            
            <div class="margemPadrao" style="text-align: center; padding-top: 3%;">
                <button id="btnDeslogar" class="botaoAzul" style="width: 25%;">DESLOGAR</button>
            </div>
            
            <p class="tituloPadrao" style="margin-top: 10%;">MEUS DADOS</p>
        </section>

        <!-- DADOS DO CLIENTE (PUXAR DO BANCO DE DADOS) -->
        <section>
            <form id="additionalInfoForm">
                <fieldset class="divBordaEscura" style="margin-top: 0%;">
                    <legend class="tituloPequeno" style="color: #011428;">E-mail:</legend>

                    <!-- Mostra o email do usuário em um imput-->
                    <input id="Email" class="textareaDevolucaoTroca" style="width: 98%; height: 5vh; margin: 1vh;" type="email" 
                    placeholder="Digite o email para atualização" 
                    required></input>
                    
                </fieldset>

                <fieldset class="divBordaEscura" style="margin-top: 1%;">
                    <legend class="tituloPequeno" style="color: #011428;">Data de nascimento:</legend>

                    <!-- Mostra a data de nascimento do usuário em um imput-->
                    <input id="dataNascimento" class="textareaDevolucaoTroca" style="width: 98%; height: 5vh; margin: 1vh;" required> </input>
                    
                </fieldset>

                <fieldset class="divBordaEscura" style="margin-top: 1%;">
                    <legend class="tituloPequeno" style="color: #011428;">Telefone:</legend>
                    
                    <!-- Mostra o telefone do usuário em um imput-->
                    <input id="Telefone" class="textareaDevolucaoTroca" style="width: 98%; height: 5vh; margin: 1vh;" type="tel"
                    placeholder="Digite o telefone para atualização" 
                    required></input>
                    
                </fieldset>

                <div class="margemPadrao" style="text-align: center; padding-top: 3%;">
                    <button class="botaoAzul" style="width: 25%;" type="submit" onclick="salvarAlteracoes()">SALVAR ALTERAÇÕES</button>
                </div>                
            </form>
        </section>

        <!-- SEÇÃO DAS INFORMAÇÕES SOBRE A CONSULTORIA AGENDADA (FAZER JS DISSO AQ) -->
        <section>
            <fieldset class="divBordaEscura">
                <legend class="tituloPequeno" style="color: #011428;">CONSULTORIA</legend>

                <div id="divInfoDaConsultoria" style="margin: 3%;">
                    <p class="textoPadrao">Aguardando a aprovação da sua consultoria.</p>
                </div>
            </fieldset>
        </section>

        <!-- SEÇÃO DAS INFORMAÇÕES SOBRE AS SOLICITAÇÕES DE TROCA E DEVOLUÇÃO (FAZER JS DISSO AQ) -->
        <section>
            <fieldset class="divBordaEscura">
                <legend class="tituloPequeno" style="color: #011428;">TROCA E DEVOLUÇÃO</legend>

                <div id="divInfoDaConsultoria" style="margin: 3%;">
                    <p class="textoPadrao">Nenhum pedido de troca ou devolução solicitado até o momento.</p>
                </div>
            </fieldset>
        </section>

        <!-- FOOTER -->
        <div class="margemSuperior" style="background-color: #047EFF; height: 8vh;"></div>

        <footer style="margin-top: 0%;">
            <div class="padroesSecaoFlexDirectionRow" style="padding: 5% 0%;">
                <div style="place-content: center; width: 30%;">
                    <img src="../src/Imagens/logoBranca.png" width="100%"/>
                </div>

                <hr>

                <div style="width: 30%;">
                    <p class="textoPadraoBranco">©2024, Prototipei. <br> Todos os direitos reservados.</p>
                </div>

                <div class="padroesSecaoFlexDirectionColumn" style="gap: 0vw; width: 40%;">
                    <p class="textoPadraoBranco" style="text-align: right; ">prototipeiltda@gmail.com <br> R. Miguel Ortega, 135</p>
                </div>
            </div>
        </footer>
        <script type="module">
        
            // Importações Firebase
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
            import { getFirestore, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
            import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

            // Firebase configuration
             const firebaseConfig = {
                apiKey: "AIzaSyBVMWxw3ubEE6HWWxzu1H_BhnWzRXQwd2g",
                authDomain: "prototipei.firebaseapp.com",
                projectId: "prototipei",
                storageBucket: "prototipei.firebasestorage.app",
                messagingSenderId: "507053339898",
                appId: "1:507053339898:web:efac2b22db7bde679d4543"
            };
            
            // Inicializa o Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const dadosUsuario = JSON.parse(localStorage.getItem("dadosUsuario"));
            
            if (dadosUsuario) {
                // Exibe o nome do usuário
                const nome = document.getElementById("nome"); // ID com letra minúscula
                nome.innerHTML = `
                    <p>Olá, ${dadosUsuario.nome || "N/A"}</p>
                `;
                
                // Exibe o e-mail
                const emailInput = document.getElementById("Email");
                emailInput.value = dadosUsuario.email || ""; // Define o valor do input como o email do usuário ou uma string vazia caso não exista
                
                // Exibe o telefone
                const telefoneInput = document.getElementById("Telefone");
                telefoneInput.value = dadosUsuario.telefone || ""; // Define o valor do input como o telefone do usuário ou uma string vazia caso não exista
                
                // Exibe a data de nascimento
                const dataNascimentoInput = document.getElementById("dataNascimento");
                dataNascimentoInput.value = dadosUsuario.dataNascimento || ""; // Define o valor do input como o telefone do usuário ou uma string vazia caso não exista
            
            } else {
                document.getElementById("informacoes").innerText = "Nenhuma informação do usuário foi encontrada.";
            }

            // Deslogando o usuário

            document.getElementById('btnDeslogar').addEventListener('click', function() {
               
               // Desconecta o usuário do Firebase
               signOut(auth).then(() => {

                   // Limpar dados do localStorage se necessário
                   localStorage.removeItem("usuarioLogado");
                   localStorage.removeItem("dadosUsuario");
                   localStorage.removeItem("qt_e");
                   localStorage.removeItem("qt_p");

                   console.log("Usuário deslogado com sucesso!"); // Verificar se o deslogamento ocorreu

                   // Redireciona para a tela home
                   window.location.href = "../telasUsuario/home.html"; //alterar para index
               }).catch((error) => {
                   console.error("Erro ao deslogar: ", error);
                   alert("Erro ao deslogar: " + error.message);
               });
           });

           //Confirmação que o usuário realmente será redirecionado para home, após se deslogar
           onAuthStateChanged(auth, (user) => {
           if (!user) {
               // Usuário não está logado, redireciona para a home
               window.location.href = "../telasUsuario/home.html";
           }
       });

        
            // Adiciona evento de envio ao formulário
            document.getElementById('additionalInfoForm').addEventListener('submit', async function(e) {
                e.preventDefault();
        
                // Recupera o userId salvo no localStorage
                const userId = localStorage.getItem('userId');
                if (!userId) {
                    alert("Erro: ID do usuário não encontrado. Retorne ao início do cadastro.");
                    return;
                }
        
                // Recupera os valores dos campos do formulário
                const email = document.getElementById('Email').value;
                const nascimento = document.getElementById('dataNascimento').value;
                const telefone = document.getElementById('Telefone').value;
        
                // Atualiza os dados no objeto dadosUsuario
                dadosUsuario.email = email;
                dadosUsuario.telefone = telefone;
                dadosUsuario.dataNascimento = nascimento;
        
                // Atualiza os dados no localStorage
                localStorage.setItem("dadosUsuario", JSON.stringify(dadosUsuario));
        
                try {
                    // Atualiza o documento do usuário no Firestore
                    await updateDoc(doc(db, "usuarios_PF", userId), {
                        email: email,
                        dataNascimento: nascimento,
                        telefone: telefone
                    });
        
                } catch (error) {
                    console.error("Erro ao atualizar as informações do usuário: ", error);
                    alert("Falha ao atualizar as informações do usuário.");
                }
            });

        </script>

    </body>
</html>
